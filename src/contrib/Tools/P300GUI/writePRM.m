function writePRM(filename,dir1,MUD)

prmname=filename;
filename=[filename '.mud'];
numch=length(MUD.channels);

% generate prm fragment
fid = fopen([dir1 prmname '.prm'], 'wt');
fprintf(fid,['Filtering matrix MUD= ' num2str(size(MUD.MUD,1)) ' 3']);
fprintf(fid,' %d %d %2.5f',reshape(MUD.MUD',1,size(MUD.MUD,1)*size(MUD.MUD,2)));
fprintf(fid,' 64 0 100 // Class Filter Additive Up / Down Weights\n');

fprintf(fid,['P3SignalProcessing int NumSamplesInERP= ' num2str(MUD.windowlen(2)) ' 144 0 1000 // Number of samples stored for each response\n']);
% fprintf(fid,['Source int SamplingRate= ' num2str(MUD.smprate) ' 128 1 40000 // the signal sampling rate\n']);
if isfield(MUD,'softwarech')
    fprintf(fid,['Source int SoftwareCh= ' num2str(MUD.softwarech) ' ' num2str(MUD.softwarech) ' 1 128 // number of digitized channels total\n']);
end

if MUD.SF==1
    fprintf(fid,['Filtering int SpatialFilteredChannels= ' num2str(MUD.softwarech) ' 4 1 128 // the number of transmitted channels\n']);
    CARmat=eye(MUD.softwarech)-ones(MUD.softwarech)/MUD.softwarech;
    CARmat=reshape(CARmat,1,MUD.softwarech^2);    
    fprintf(fid,['Filtering matrix SpatialFilterKernal= ' num2str(MUD.softwarech) ' ' num2str(MUD.softwarech)]);
    fprintf(fid,' %2.5f',CARmat);
    fprintf(fid,' 64 -100 100 // Spatial Filter Kernal Weights\n');
else
    fprintf(fid,['Filtering int SpatialFilteredChannels= ' num2str(numch) ' 4 1 128 // the number of transmitted channels\n']);
    fprintf(fid,['Filtering matrix SpatialFilterKernal= ' num2str(numch) ' ' num2str(numch)]);
    fprintf(fid,' %2.5f',reshape(eye(numch),1,numch^2));
    fprintf(fid,' 64 -100 100 // Spatial Filter Kernal Weights\n');
end

fprintf(fid,['Source int TransmitCh= ' num2str(numch) ' 2 1 64 // Number of Spatially Filtered Channels\n']);
fprintf(fid,['Source intlist TransmitChList= ' num2str(numch)]);
fprintf(fid,' %d',MUD.channels);
fprintf(fid,' 1 1 128 // list of transmitted channels\n');

fclose(fid);







% Filtering matrix MUD= 552 3 1 25 0.83514 1 26 0.83514 1 27 0.83514 1 28 0.83514 1 29 0.83514 1 30 0.83514 1 31 0.83514 1 32 0.83514 1 33 0.83514 1 34 0.83514 1 35 0.83514 1 36 0.83514 1 61 -0.79451 1 62 -0.79451 1 63 -0.79451 1 64 -0.79451 1 65 -0.79451 1 66 -0.79451 1 67 -0.79451 1 68 -0.79451 1 69 -0.79451 1 70 -0.79451 1 71 -0.79451 1 72 -0.79451 1 169 0.31696 1 170 0.31696 1 171 0.31696 1 172 0.31696 1 173 0.31696 1 174 0.31696 1 175 0.31696 1 176 0.31696 1 177 0.31696 1 178 0.31696 1 179 0.31696 1 180 0.31696 2 13 -0.9367 2 14 -0.9367 2 15 -0.9367 2 16 -0.9367 2 17 -0.9367 2 18 -0.9367 2 19 -0.9367 2 20 -0.9367 2 21 -0.9367 2 22 -0.9367 2 23 -0.9367 2 24 -0.9367 2 25 -1.8476 2 26 -1.8476 2 27 -1.8476 2 28 -1.8476 2 29 -1.8476 2 30 -1.8476 2 31 -1.8476 2 32 -1.8476 2 33 -1.8476 2 34 -1.8476 2 35 -1.8476 2 36 -1.8476 2 37 -1.9516 2 38 -1.9516 2 39 -1.9516 2 40 -1.9516 2 41 -1.9516 2 42 -1.9516 2 43 -1.9516 2 44 -1.9516 2 45 -1.9516 2 46 -1.9516 2 47 -1.9516 2 48 -1.9516 2 49 1.9956 2 50 1.9956 2 51 1.9956 2 52 1.9956 2 53 1.9956 2 54 1.9956 2 55 1.9956 2 56 1.9956 2 57 1.9956 2 58 1.9956 2 59 1.9956 2 60 1.9956 2 61 2.9076 2 62 2.9076 2 63 2.9076 2 64 2.9076 2 65 2.9076 2 66 2.9076 2 67 2.9076 2 68 2.9076 2 69 2.9076 2 70 2.9076 2 71 2.9076 2 72 2.9076 2 85 2.1315 2 86 2.1315 2 87 2.1315 2 88 2.1315 2 89 2.1315 2 90 2.1315 2 91 2.1315 2 92 2.1315 2 93 2.1315 2 94 2.1315 2 95 2.1315 2 96 2.1315 2 145 -0.93074 2 146 -0.93074 2 147 -0.93074 2 148 -0.93074 2 149 -0.93074 2 150 -0.93074 2 151 -0.93074 2 152 -0.93074 2 153 -0.93074 2 154 -0.93074 2 155 -0.93074 2 156 -0.93074 2 193 -0.65919 2 194 -0.65919 2 195 -0.65919 2 196 -0.65919 2 197 -0.65919 2 198 -0.65919 2 199 -0.65919 2 200 -0.65919 2 201 -0.65919 2 202 -0.65919 2 203 -0.65919 2 204 -0.65919 3 37 3.9716 3 38 3.9716 3 39 3.9716 3 40 3.9716 3 41 3.9716 3 42 3.9716 3 43 3.9716 3 44 3.9716 3 45 3.9716 3 46 3.9716 3 47 3.9716 3 48 3.9716 3 49 -3.0349 3 50 -3.0349 3 51 -3.0349 3 52 -3.0349 3 53 -3.0349 3 54 -3.0349 3 55 -3.0349 3 56 -3.0349 3 57 -3.0349 3 58 -3.0349 3 59 -3.0349 3 60 -3.0349 3 61 -4.9446 3 62 -4.9446 3 63 -4.9446 3 64 -4.9446 3 65 -4.9446 3 66 -4.9446 3 67 -4.9446 3 68 -4.9446 3 69 -4.9446 3 70 -4.9446 3 71 -4.9446 3 72 -4.9446 3 85 3.6778 3 86 3.6778 3 87 3.6778 3 88 3.6778 3 89 3.6778 3 90 3.6778 3 91 3.6778 3 92 3.6778 3 93 3.6778 3 94 3.6778 3 95 3.6778 3 96 3.6778 3 97 0.87832 3 98 0.87832 3 99 0.87832 3 100 0.87832 3 101 0.87832 3 102 0.87832 3 103 0.87832 3 104 0.87832 3 105 0.87832 3 106 0.87832 3 107 0.87832 3 108 0.87832 3 109 1.1908 3 110 1.1908 3 111 1.1908 3 112 1.1908 3 113 1.1908 3 114 1.1908 3 115 1.1908 3 116 1.1908 3 117 1.1908 3 118 1.1908 3 119 1.1908 3 120 1.1908 3 193 -1.3962 3 194 -1.3962 3 195 -1.3962 3 196 -1.3962 3 197 -1.3962 3 198 -1.3962 3 199 -1.3962 3 200 -1.3962 3 201 -1.3962 3 202 -1.3962 3 203 -1.3962 3 204 -1.3962 4 13 -2.9214 4 14 -2.9214 4 15 -2.9214 4 16 -2.9214 4 17 -2.9214 4 18 -2.9214 4 19 -2.9214 4 20 -2.9214 4 21 -2.9214 4 22 -2.9214 4 23 -2.9214 4 24 -2.9214 4 25 -3.2575 4 26 -3.2575 4 27 -3.2575 4 28 -3.2575 4 29 -3.2575 4 30 -3.2575 4 31 -3.2575 4 32 -3.2575 4 33 -3.2575 4 34 -3.2575 4 35 -3.2575 4 36 -3.2575 4 37 1.4786 4 38 1.4786 4 39 1.4786 4 40 1.4786 4 41 1.4786 4 42 1.4786 4 43 1.4786 4 44 1.4786 4 45 1.4786 4 46 1.4786 4 47 1.4786 4 48 1.4786 4 49 7.5657 4 50 7.5657 4 51 7.5657 4 52 7.5657 4 53 7.5657 4 54 7.5657 4 55 7.5657 4 56 7.5657 4 57 7.5657 4 58 7.5657 4 59 7.5657 4 60 7.5657 4 61 2.3831 4 62 2.3831 4 63 2.3831 4 64 2.3831 4 65 2.3831 4 66 2.3831 4 67 2.3831 4 68 2.3831 4 69 2.3831 4 70 2.3831 4 71 2.3831 4 72 2.3831 4 85 -6.0701 4 86 -6.0701 4 87 -6.0701 4 88 -6.0701 4 89 -6.0701 4 90 -6.0701 4 91 -6.0701 4 92 -6.0701 4 93 -6.0701 4 94 -6.0701 4 95 -6.0701 4 96 -6.0701 4 121 1.2344 4 122 1.2344 4 123 1.2344 4 124 1.2344 4 125 1.2344 4 126 1.2344 4 127 1.2344 4 128 1.2344 4 129 1.2344 4 130 1.2344 4 131 1.2344 4 132 1.2344 5 133 1.2818 5 134 1.2818 5 135 1.2818 5 136 1.2818 5 137 1.2818 5 138 1.2818 5 139 1.2818 5 140 1.2818 5 141 1.2818 5 142 1.2818 5 143 1.2818 5 144 1.2818 5 145 -1.0573 5 146 -1.0573 5 147 -1.0573 5 148 -1.0573 5 149 -1.0573 5 150 -1.0573 5 151 -1.0573 5 152 -1.0573 5 153 -1.0573 5 154 -1.0573 5 155 -1.0573 5 156 -1.0573 6 13 6.4309 6 14 6.4309 6 15 6.4309 6 16 6.4309 6 17 6.4309 6 18 6.4309 6 19 6.4309 6 20 6.4309 6 21 6.4309 6 22 6.4309 6 23 6.4309 6 24 6.4309 6 25 3.7877 6 26 3.7877 6 27 3.7877 6 28 3.7877 6 29 3.7877 6 30 3.7877 6 31 3.7877 6 32 3.7877 6 33 3.7877 6 34 3.7877 6 35 3.7877 6 36 3.7877 6 37 -4.3581 6 38 -4.3581 6 39 -4.3581 6 40 -4.3581 6 41 -4.3581 6 42 -4.3581 6 43 -4.3581 6 44 -4.3581 6 45 -4.3581 6 46 -4.3581 6 47 -4.3581 6 48 -4.3581 6 49 -10 6 50 -10 6 51 -10 6 52 -10 6 53 -10 6 54 -10 6 55 -10 6 56 -10 6 57 -10 6 58 -10 6 59 -10 6 60 -10 6 61 -3.5737 6 62 -3.5737 6 63 -3.5737 6 64 -3.5737 6 65 -3.5737 6 66 -3.5737 6 67 -3.5737 6 68 -3.5737 6 69 -3.5737 6 70 -3.5737 6 71 -3.5737 6 72 -3.5737 6 85 3.6749 6 86 3.6749 6 87 3.6749 6 88 3.6749 6 89 3.6749 6 90 3.6749 6 91 3.6749 6 92 3.6749 6 93 3.6749 6 94 3.6749 6 95 3.6749 6 96 3.6749 6 97 2.9619 6 98 2.9619 6 99 2.9619 6 100 2.9619 6 101 2.9619 6 102 2.9619 6 103 2.9619 6 104 2.9619 6 105 2.9619 6 106 2.9619 6 107 2.9619 6 108 2.9619 6 109 1.3414 6 110 1.3414 6 111 1.3414 6 112 1.3414 6 113 1.3414 6 114 1.3414 6 115 1.3414 6 116 1.3414 6 117 1.3414 6 118 1.3414 6 119 1.3414 6 120 1.3414 6 121 -1.6667 6 122 -1.6667 6 123 -1.6667 6 124 -1.6667 6 125 -1.6667 6 126 -1.6667 6 127 -1.6667 6 128 -1.6667 6 129 -1.6667 6 130 -1.6667 6 131 -1.6667 6 132 -1.6667 6 133 -1.3813 6 134 -1.3813 6 135 -1.3813 6 136 -1.3813 6 137 -1.3813 6 138 -1.3813 6 139 -1.3813 6 140 -1.3813 6 141 -1.3813 6 142 -1.3813 6 143 -1.3813 6 144 -1.3813 6 145 1.93 6 146 1.93 6 147 1.93 6 148 1.93 6 149 1.93 6 150 1.93 6 151 1.93 6 152 1.93 6 153 1.93 6 154 1.93 6 155 1.93 6 156 1.93 7 25 2.4303 7 26 2.4303 7 27 2.4303 7 28 2.4303 7 29 2.4303 7 30 2.4303 7 31 2.4303 7 32 2.4303 7 33 2.4303 7 34 2.4303 7 35 2.4303 7 36 2.4303 7 37 -2.5844 7 38 -2.5844 7 39 -2.5844 7 40 -2.5844 7 41 -2.5844 7 42 -2.5844 7 43 -2.5844 7 44 -2.5844 7 45 -2.5844 7 46 -2.5844 7 47 -2.5844 7 48 -2.5844 7 49 -2.4283 7 50 -2.4283 7 51 -2.4283 7 52 -2.4283 7 53 -2.4283 7 54 -2.4283 7 55 -2.4283 7 56 -2.4283 7 57 -2.4283 7 58 -2.4283 7 59 -2.4283 7 60 -2.4283 7 61 2.3737 7 62 2.3737 7 63 2.3737 7 64 2.3737 7 65 2.3737 7 66 2.3737 7 67 2.3737 7 68 2.3737 7 69 2.3737 7 70 2.3737 7 71 2.3737 7 72 2.3737 7 73 1.5623 7 74 1.5623 7 75 1.5623 7 76 1.5623 7 77 1.5623 7 78 1.5623 7 79 1.5623 7 80 1.5623 7 81 1.5623 7 82 1.5623 7 83 1.5623 7 84 1.5623 7 97 -1.6565 7 98 -1.6565 7 99 -1.6565 7 100 -1.6565 7 101 -1.6565 7 102 -1.6565 7 103 -1.6565 7 104 -1.6565 7 105 -1.6565 7 106 -1.6565 7 107 -1.6565 7 108 -1.6565 7 109 -2.0657 7 110 -2.0657 7 111 -2.0657 7 112 -2.0657 7 113 -2.0657 7 114 -2.0657 7 115 -2.0657 7 116 -2.0657 7 117 -2.0657 7 118 -2.0657 7 119 -2.0657 7 120 -2.0657 7 193 2.2854 7 194 2.2854 7 195 2.2854 7 196 2.2854 7 197 2.2854 7 198 2.2854 7 199 2.2854 7 200 2.2854 7 201 2.2854 7 202 2.2854 7 203 2.2854 7 204 2.2854 64 0 100 // Class Filter Additive Up / Down Weights
% P3SignalProcessing int NumSamplesInERP= 200 144 0 1000 // Number of samples stored for each response
% Source int SamplingRate= 256 128 1 40000 // the signal sampling rate
% Source int SoftwareCh= 16 16 1 128 // number of digitized channels total
% Filtering int SpatialFilteredChannels= 7 2 1 64 // Number of Spatially Filtered Channels
% Filtering matrix SpatialFilterKernal= 7 7 1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 1 64 -100 100 // Spatial Filter Kernal Weights
% Source int TransmitCh= 7 4 1 128 // the number of transmitted channels
% Source intlist TransmitChList= 7 2 6 11 12 13 15 16 1 1 128 // list of
% transmitted channels
